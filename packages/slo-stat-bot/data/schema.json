{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "SLO rules",
    "description": "Schema for defining the SLO rules that apply to a repository",
    "definitions": {
        "appliesTo": {
            "description": "Describes what this rule applies to",
            "type": "object",
            "properties": {
                "gitHubLabels": { 
                    "description": "Match issues/PRs with these GitHub labels",
                    "type": ["string", "array"] 
                },
                "excludedGitHubLabels": {
                    "description": "Exclude issues/PRs with these GitHub labels",
                    "type": ["string", "array"]
                },
                "issues": { 
                    "description": "Match issues",
                    "type": "boolean", 
                    "default": true
                },
                "prs": { 
                    "description": "Match PRs",
                    "type": "boolean",
                    "default": false
                }
            },
            "required": []
        },
        "complianceSettings": {
            "description": "Settings for the SLI to be found compliant",
            "type": "object",
            "properties": {
                "responseTime": { 
                    "description": "Matching issues with no response within this timeframe are non-compliant. A number value represents seconds; a string value should be formatted as a number followed by one of: d, h, m, s where d=days, h=hours, m=minutes and s=seconds. A value of 0 is considered as not needing a response.",
                    "type": ["number", "string"],
                    "minimum": 0,
                    "pattern": "(^([0-9]+[dhms])+)(?!.)"
                }, 
                "resolutionTime": { 
                    "description": "Matching issues open for longer than this timeframe are non-compliant. A number value represents seconds; a string value should be formatted as a number followed by one of: d, h, m, s where d=days, h=hours, m=minutes and s=seconds. A value of 0 is considered as not needing a response.",
                    "type": ["number", "string"], 
                    "minimum": 0,
                    "pattern": "(^([0-9]+[dhms])+)(?!.)"
                }, 
                "requiresAssignee": { 
                    "description": "Matching issues require an assignee to be compliant",
                    "type": "boolean",
                    "default": false
                },
                "responders": {
                    "description": "Defaults to people with write access to the repository. If specified, at least one field must be defined and all fields not defined default to none/empty",
                    "type": "object",
                    "properties": {
                        "owners": {
                            "description": "A uri reference to a file containing users marked as responders to this SLO",
                            "type": ["string", "array"],
                            "format": "uri-reference",
                            "items": {
                                "type": "string",
                                "format": "uri-reference"
                            }
                        },
                        "contributors": {
                            "description": "As defined by GitHub, one of: WRITE|ADMIN|OWNER. All users in the designated group are responders",
                            "type": "string",
                            "enum": ["WRITE", "ADMIN", "OWNER"]
                        },
                        "users": {
                            "description": "An array of users that are responders",
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    },
                    "minProperties": 1
                },
                "default": {
                    "contributors": "WRITE"
                } 
            },
            "required": ["responseTime", "resolutionTime"]
        },
        "SLO": {
            "description": "Service level objective",
            "type": "object",
            "properties": {
                "appliesTo": { "$ref": "#/definitions/appliesTo"},
                "complianceSettings": { "$ref": "#/definitions/complianceSettings" }
            },
            "required": ["appliesTo", "complianceSettings"]
        }
    },

    "type:": "array",
    "items": {
        "$ref": "#/definitions/SLO"
    }
}
