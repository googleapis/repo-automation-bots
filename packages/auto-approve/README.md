# auto-approve
Auto-approve is a bot that approves and tags pull requests to automatically merge. Pull requests are approved and tagged if they match
the settings in the configuration file for that repository, and if that configuration file meets guidelines detailed below. 

This bot checks incoming pull requests against the `.github/auto-approve.yml` file that lives in the same repository.

## Using the bot
To use the bot, start by [enabling it on your repository](https://github.com/apps/auto-approve).  It is on automatically for the `googleapis` org.

Next, create a file in `.github/auto-approve.yml` in your repository.  The complete options supported include:

```yaml
rules:
# Currently we allow a small subset of valid types of PRs to get merged.  The following three
# rules can be used altogether or any subset. The bot confirms that incoming pull requests'
# author match the authors below, and subsequently, the allowed title of the pull requests.
# `changedFiles` are allowed patterns for the file paths that are changed in a PR, and 
# `maxFiles` are the maximum amount of files that are allowed to be changed in that PR. Neither
# changedFiles nor maxFiles are required, but they will be enforced on a PR if they are set.
# Each rule only has the allowed values listed below; there is no mixing of values between rules,
# nor can any values be replaced. To understand the full set of rules for the JSON file, check out
# src/valid-pr-schema.json

# Option 1: incoming PRs from googleapis publisher
- author: "googleapis-publisher"

# Title for PRs from googleapis-publisher MUST start with `chore: autogenerated discovery document update`.
# Title must be regex.
  title: "^chore: autogenerated discovery document update"

# Option 2: incoming PRs from yoshi-automation
- author: "yoshi-automation"

# Title for PRs from yoshi-automation MUST be exactly `chore: regenerate README`, but it is required
# to configure the title in regex.
  title: "^chore: regenerate README$"

# (Optional) The only changed file paths in an incoming PR MUST be exactly `README.md` or 
# `.github/readme/synth.metadata/synth.metadata`. These are listed in regex. If this property 
# is omitted, auto-approve bot will allow PRs that match the author and title to merge, without
# checking the file paths. 
  changedFiles:
  - "^README.md$"
  - "^\\.github/readme/synth\\.metadata/synth\\.metadata$"

# (Optional) The max amount of files changed in a PR. 
  maxFiles: 2

# Option 3: incoming PRs from yoshi-code-bot
- author: "yoshi-code-bot"

# Title for PRs from yoshi-code-bot MUST start with `chore: release`.
  title: "^chore: release"

# (Optional) The only changed file paths in an incoming PR MUST end with `package.json` or 
# `CHANGELOG.md`. These are listed in regex. If this property 
# is omitted, auto-approve bot will allow PRs that match the author and title to merge, without
# checking the file paths. 
  changedFiles:
  - "package\\.json$"
  - "CHANGELOG\\.md$"

# (Optional) The max amount of files changed in a PR. 
  maxFiles: 3
```
Next, create a CODEWONERS file, under `.github/CODEOWNERS` in your repository. You
must add a line that adds the Github Automation team as a codeowner for the `auto-approve.yml` file you have created, and they will be alerted anytime there is
a change to the file. See the example below.

```
# Code owners file.
# This file controls who is tagged for review for any given pull request.
#
# For syntax help see:
# https://help.github.com/en/github/creating-cloning-and-archiving-repositories/about-code-owners#codeowners-syntax


.github/auto-approve.yml                 @googleapis/github-automation
```

The bot is triggered every time a PR is opened, reopened, or edited.

This bot uses nock for mocking requests to GitHub, and snap-shot-it for capturing responses; This allows updates to the API surface to be treated as a visual diff, rather than tediously asserting against each field.

## Running tests:

`npm test`

## Contributing

If you have suggestions for how auto-approve could be improved, or want to report a bug, open an issue! We'd love all and any contributions.

For more, check out the Contributing Guide.

License
Apache 2.0 Â© 2019 Google LLC.