#  GitHub Automation Bots Monitoring System (Internal Only)

A system to collect metrics on GitHub Repo Automation Bot executions and make it easily accessible to bot SREs and developers for debugging and facilitating the development process.

## Usage

### Bot SRE: View currently configured metrics

Currently, there are 3 ways to view Automation Bot metrics, each of which are described below. 

The roadmap for this project includes supporting all metrics in the [Metrics Dashboard](#Metrics-Dashboard) so you don't have to choose from the 3 methods below.

#### (Option 1) Cloud Logging: Logs-based metrics only

Logs-based metrics are one of the sources from which the Monitoring System collects data. You can view these metrics directly in Cloud Logging as well in the repo-automation-bots GCP Project (internal). 

> Note: You will need access to this project in order to view the logs

For more information on which metrics are emitted via logs, refer to the [gcf-utils documentation](https://github.com/googleapis/repo-automation-bots/tree/master/packages/gcf-utils).

#### (Option 2) Metrics Dashboard: subset of all metrics

A subset of the metrics mined by the Monitoring System are visualized on the [Metrics Dashboard deployed here](https://repo-automation-bots-metrics.web.app/). 

> Note: You will need an `@google.com` account to be able to access the data on the dashboard. 

In the future, we will be making all metrics available via this dashboard. To learn more, see the [Metrics Dashboard section](#Metrics-Dashboard) below

#### (Option 3) Firestore: all available metrics

All data points collected and processed by the Monitoring System are stored in the Firestore instance for this project. To learn more about how to query and retrieve this data, see the [Firestore section](#Firestore) below.

### Bot Developer: Log metrics from your bot

#### Trigger Information and GitHub Actions

Execution trigger information (i.e. what caused the execution, source repo, etc.) and GitHub action information (i.e. issues labelled, pull requests closed, etc.) are automatically logged by gcf-utils. For more information on the exact properties that are logged automatically, please refer to the [gcf-utils documentation](https://github.com/googleapis/repo-automation-bots/tree/master/packages/gcf-utils).

These metrics are already collected and processed by the Monitoring System by default and metrics for any new bots will also be automatically supported.

> :warning: If your Bot is not automatically logging the information above, please ensure that you are using gcf-utils 5.5.1 or above and you have `logging: true` in the `WrapperOptions` passed to `GCFBootstrapper.gcf()`

#### Custom Metrics

[GCF-Logger in gcf-utils](https://github.com/googleapis/repo-automation-bots/tree/master/packages/gcf-utils) also supports logging custom metrics. However, these are not supported by default in the Monitoring System - please view the [Data Processor documentation](data-processor) to learn how to add support for new metrics.

## Overview of Components

![Architecture Overview](./docs/assets/architecture-overview.png)
> Note: This diagram represents the architectural goal for the system and not the current architecture

### Data Processor

A NodeJS application to continuously consume new data generated by the automation bots as well as other related sources, process it into a standardized format, and store it in Firestore. It is currently deployed in a Cloud Run instance in the repo-automation-bots GCP project (internal).

> Note: You will need access to the repo-automation-bots GCP project in order to view the Cloud Run instance

### Firestore

A NoSQL Firestore database to store data processed by the Data Processor for future retrieval and querying by other applications.

The Firestore instance currently being used by the Monitoring System is deployed within the [repo-automation-bots-metrics project](https://firebase.corp.google.com/project/repo-automation-bots-metrics/overview).

> Note: You will need access to this project in order to view the Firestore instance

[Learn more about the NoSQL schema here](data-processor/#firestore-schema)

### Metrics Dashboard

A web-based dashboard to visualize metrics collected and mined by the Monitoring System. The current dashboard [is deployed here](https://repo-automation-bots-metrics.web.app/). 

> Note: You will need an `@google.com` account to be able to access the data on the dashboard. 

Currently, the dashboard only supports a subset of the metrics available via the Monitoring System. Adding more metrics to the dashboard is an ongoing effort.

[Learn more here](metrics-dashboard)

## Contributing

If you have suggestions for how monitoring-system could be improved, or want to report a bug, open an issue! We'd love all and any contributions.

For more, check out the [Contributing Guide](CONTRIBUTING.md).

## License

Apache 2.0 Â© 2019 Google Inc.
